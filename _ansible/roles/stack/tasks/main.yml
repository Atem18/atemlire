- name: Ensure Nginx directory exists
  file: path=/etc/nginx state=directory

- name: Download nginx tmpl file
  get_url:
    url: https://raw.githubusercontent.com/jwilder/nginx-proxy/master/nginx.tmpl
    dest: /etc/nginx/nginx.tmpl

- name: Ensure DH Parameters directory exists
  file: path=/etc/nginx/dhparam state=directory

- name: Generate DH Parameters
  openssl_dhparam:
    path: /etc/nginx/dhparam/dhparam.pem
    size: 2048

- name: Install nginx systemd unit file
  template: src=nginx.service.j2 dest=/etc/systemd/system/nginx.service

- name: Start nginx
  systemd: state=restarted name=nginx daemon_reload=yes

- name: Install nginx-gen systemd unit file
  template: src=nginx-gen.service.j2 dest=/etc/systemd/system/nginx-gen.service

- name: Start nginx-gen
  systemd: state=restarted name=nginx-gen daemon_reload=yes

- name: Install nginx-letsencrypt systemd unit file
  template: src=nginx-letsencrypt.service.j2 dest=/etc/systemd/system/nginx-letsencrypt.service

- name: Start nginx-letsencrypt
  systemd: state=restarted name=nginx-letsencrypt daemon_reload=yes